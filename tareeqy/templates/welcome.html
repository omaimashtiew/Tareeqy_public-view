<!DOCTYPE html>
{% load static %}
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>طريقي - مرحباً</title>
    <link rel="icon" type="image/png" href="{% static 'images/road1.png' %}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" integrity="sha384-PJsE/product+M38w/R0bXg89ZgP4GCkRkXk5p1gXn3M75qf71hXbB+C7N7F/B8N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Ensure you have a welcome_style.css or welcome-page.css as linked -->
    <link rel="stylesheet" href="{% static 'css/welcome-page.css' %}"> <!-- Or welcome-page.css -->
    <link rel="manifest" href="{% static 'manifest.json' %}">
<meta name="theme-color" content="#000000"/>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="/static/icons/cover1.jpg">

</head>
<body>
    <div class="welcome-container">
        <div class="welcome-background"></div>
        <div class="welcome-content">
            <div class="welcome-content-background"></div>
            <div class="logo-container">
                <img src="{% static 'images/road1.png' %}" alt="شعار طريقي" class="logo-image">
                <div class="logo-pulse"></div>
            </div>
            
            <h1 class="welcome-title">طريقي</h1>
            <p class="welcome-subtitle">تنقل بثقة</p>
            
            <div class="info-text">
                <p>يساعدك تطبيق طريقي على التنقل عبر نقاط التفتيش مع تحديثات حالة في الوقت الفعلي ومعلومات حركة المرور.</p>
            </div>
            
            <div class="location-permission">
                <div class="permission-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <div class="permission-text">
                    <h3>الوصول إلى الموقع</h3>
                    <p>يحتاج تطبيق طريقي إلى الوصول إلى موقعك لإظهار نقاط التفتيش القريبة وتوفير إرشادات الطريق.</p>
                </div>
            </div>
             
            <button id="start-btn" class="start-button">
                <span>ابدأ الآن</span>
                <i class="fas fa-arrow-left me-2"></i>
            </button>
            <button id="ios-install-btn" class="start-button mt-3">
  <i class="fas fa-share-square me-2"></i> أضف التطبيق للشاشة الرئيسية
</button>
<button id="desktop-install-btn" class="start-button mt-3" >
  <i class="fas fa-download me-2"></i> تثبيت التطبيق على هذا الجهاز
</button>


            <div class="language-selector">
                <a href="?lang=en">English</a> | 
                <a href="?lang=ar" class="active">العربية</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    
    <!-- CRITICAL: Define MAP_PAGE_URL using Django's url tag -->
    <script>
        const MAP_PAGE_URL = "{% url 'tareeqy_app:map_page' %}";
    </script>
    <script src="{% static 'js/welcome.js' %}"></script>
    <script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
navigator.serviceWorker.register('/static/sw.js')
      .then(registration => console.log('ServiceWorker registered'))
      .catch(err => console.log('ServiceWorker registration failed: ', err));
  });
}
</script>

<script>
let deferredPrompt = null;

function isIosSafari() {
  const ua = window.navigator.userAgent;
  return /iPhone|iPad|iPod/.test(ua) && /Safari/.test(ua) && !/CriOS|FxiOS/.test(ua);
}

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;

    // Chrome / Edge Desktop or Android
    const desktopInstallBtn = document.getElementById('desktop-install-btn');
    desktopInstallBtn.style.display = 'block';
    desktopInstallBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') {
        console.log('تم تثبيت التطبيق');
      } else {
        console.log('المستخدم رفض التثبيت');
      }
      desktopInstallBtn.style.display = 'none';
      deferredPrompt = null;
    });
  }
);
</script>

<script>
function isIosSafari() {
  const ua = window.navigator.userAgent;
  return /iPhone|iPad|iPod/.test(ua) &&
         /Safari/.test(ua) &&
         !/CriOS|FxiOS|EdgiOS|OPiOS/.test(ua); // excludes Chrome, Firefox, Edge, Opera on iOS
}

window.addEventListener('load', () => {
  const iosBtn = document.getElementById('ios-install-btn');

  if (isIosSafari()) {
    iosBtn.style.display = 'block';
    iosBtn.addEventListener('click', () => {
      alert("لإضافة التطبيق للشاشة الرئيسية:\n1. اضغط على زر المشاركة (المربع والسهم).\n2. اختر 'إضافة إلى الشاشة الرئيسية'.");
    });
  } else {
    iosBtn.style.display = 'none'; // إخفاء الزر في أي بيئة غير Safari iOS
  }
});
</script>


<script>
function isFirefox() {
  return navigator.userAgent.toLowerCase().includes('firefox');
}

window.addEventListener('load', () => {
  if (isFirefox()) {
    const btn = document.createElement('button');
    btn.className = 'start-button mt-3';
    btn.innerHTML = `<i class="fas fa-info-circle me-2"></i> تثبيت يدوي عبر متصفح Firefox`;

    btn.onclick = () => {
      alert("للتثبيت على Firefox:\n1. اضغط على زر القائمة (⋮).\n2. اختر 'Install Site as App' أو 'Save to Desktop'.");
    };

    document.querySelector('.welcome-content').appendChild(btn);
  }
});
</script>

</body>
</html>