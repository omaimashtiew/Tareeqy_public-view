<!DOCTYPE html>
{% load static %}
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>طريقي - مرحباً</title>
    <link rel="icon" type="image/png" href="{% static 'images/road1.png' %}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" integrity="sha384-PJsE/product+M38w/R0bXg89ZgP4GCkRkXk5p1gXn3M75qf71hXbB+C7N7F/B8N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Ensure you have a welcome_style.css or welcome-page.css as linked -->
    <link rel="stylesheet" href="{% static 'css/welcome-page.css' %}"> <!-- Or welcome-page.css -->
    <link rel="manifest" href="{% static 'manifest.json' %}">
<meta name="theme-color" content="#000000"/>
</head>
<body>
    <div class="welcome-container">
        <div class="welcome-background"></div>
        <div class="welcome-content">
            <div class="welcome-content-background"></div>
            <div class="logo-container">
                <img src="{% static 'images/road1.png' %}" alt="شعار طريقي" class="logo-image">
                <div class="logo-pulse"></div>
            </div>
            
            <h1 class="welcome-title">طريقي</h1>
            <p class="welcome-subtitle">تنقل بثقة</p>
            
            <div class="info-text">
                <p>يساعدك تطبيق طريقي على التنقل عبر نقاط التفتيش مع تحديثات حالة في الوقت الفعلي ومعلومات حركة المرور.</p>
            </div>
            
            <div class="location-permission">
                <div class="permission-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <div class="permission-text">
                    <h3>الوصول إلى الموقع</h3>
                    <p>يحتاج تطبيق طريقي إلى الوصول إلى موقعك لإظهار نقاط التفتيش القريبة وتوفير إرشادات الطريق.</p>
                </div>
            </div>
             
            <button id="start-btn" class="start-button">
                <span>ابدأ الآن</span>
                <i class="fas fa-arrow-left me-2"></i>
            </button>
            
            <div class="language-selector">
                <a href="?lang=en">English</a> | 
                <a href="?lang=ar" class="active">العربية</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    
    <!-- CRITICAL: Define MAP_PAGE_URL using Django's url tag -->
    <script>
        const MAP_PAGE_URL = "{% url 'tareeqy_app:map_page' %}";
    </script>
    <script src="{% static 'js/welcome.js' %}"></script>
    <script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('{% static "sw.js" %}')
      .then(registration => console.log('ServiceWorker registered'))
      .catch(err => console.log('ServiceWorker registration failed: ', err));
  });
}
</script>

<script>
// تخزين event prompt globally
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  // منع المتصفح من العرض التلقائي
  e.preventDefault();
  // حفظ event لإظهاره لاحقًا
  deferredPrompt = e;
  // إظهار زر التثبيت المخصص
  showInstallButton();
});

function showInstallButton() {
  const installBtn = document.createElement('button');
  installBtn.id = 'install-btn';
  installBtn.innerHTML = `
    <i class="fas fa-download"></i> تثبيت التطبيق
  `;
  installBtn.style.cssText = `
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
    padding: 10px 15px;
    background: #2A5C99;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  `;
  
  document.body.appendChild(installBtn);
  
  installBtn.addEventListener('click', async () => {
    if (!deferredPrompt) return;
    // عرض prompt التثبيت
    deferredPrompt.prompt();
    // انتظار اختيار المستخدم
    const { outcome } = await deferredPrompt.userChoice;
    console.log(`User response: ${outcome}`);
    // إزالة الزر بعد التثبيت
    installBtn.remove();
    deferredPrompt = null;
  });
}
</script>
</body>
</html>