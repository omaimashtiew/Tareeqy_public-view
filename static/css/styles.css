/* static/css/style_final.css */
:root {
    --primary-color: #9c27b0; /* Purple */
    --secondary-color: #673ab7; /* Deep Purple */
    --accent-color: #ff4081; /* Pink */
    --light-color: #f8f9fa;
    --dark-color: #343a40;
    --success-color: #28a745; /* Green */
    --warning-color: #ffc107; /* Yellow */
    --danger-color: #dc3545; /* Red */
    --unknown-color: #6c757d; /* Grey */
    --text-color: #333;
    --text-color-light: #f8f9fa; /* For text on dark/colored backgrounds */
    --header-gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    --header-height: 56px;
    --footer-height: 56px;
    --sidebar-width-mobile: clamp(280px, 80vw, 320px);
    --sidebar-width-desktop: 300px;
    --border-radius: 0.375rem; 
    --base-font-size: 16px; /* Base font size for scaling */
    --primary-color-alpha: rgba(156, 39, 176, 0.4); /* For user location pulse, slightly more visible */
}

html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    font-family: "Tajawal", sans-serif; 
    background-color: var(--light-color);
    color: var(--text-color);
    direction: rtl;
    overflow: hidden; 
    font-size: var(--base-font-size); /* Apply base font size */
}

.app-container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
}

/* Header */
.app-header {
    height: var(--header-height);
    flex-shrink: 0; 
    background: var(--header-gradient);
    box-shadow: var(--shadow);
    z-index: 1030; 
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
    display: flex;
    align-items: center;
}
.app-header .container-fluid { width: 100%; }
.app-header .navbar-brand {
    color: var(--text-color-light);
    font-weight: 500;
    display: flex;
    align-items: center;
    font-size: calc(var(--base-font-size) * 1.2); /* Larger brand text */
}
.app-header .navbar-brand img {
    margin-left: 8px; 
    width: 30px; height: 30px; /* Ensure image size */
}

/* Content Wrapper: Holds Map and Sidebar */
.content-wrapper {
    display: flex;
    flex: 1; 
    position: relative; 
    overflow: hidden;
}

/* Map Area */
#map {
    flex-grow: 1; 
    height: 100%; 
    min-height: 0; 
    z-index: 1;   
    outline: none;
}

/* Main Search Bar in Header */
.search-container {
    position: relative;
    flex-grow: 1; 
    max-width: 450px;
    margin: 0 10px; 
}
#search-input {
    padding-right: 15px; 
    padding-left: 45px; 
    border-radius: var(--border-radius);
    border: 1px solid transparent; 
    height: calc(var(--header-height) - 16px);
    max-height: 40px;
    color: var(--text-color) !important; 
    background-color: rgba(255,255,255,0.9) !important; 
    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    font-size: calc(var(--base-font-size) * 0.95); /* Larger search input text */
}
#search-input:focus {
    background-color: white !important;
    border-color: var(--accent-color);
    box-shadow: 0 0 0 0.2rem rgba(255, 64, 129, 0.25); 
}
#search-input::placeholder { color: #757575; opacity: 1; }
.btn-search-icon {
    position: absolute; left: 0; top: 0; bottom: 0; background: transparent;
    border: none; color: #757575; padding: 0 0.75rem; z-index: 4; cursor: pointer;
    height: 100%;
}
.btn-search-icon:hover { color: var(--primary-color); }
.search-results {
    position: absolute; top: calc(100% + 2px); left: 0; right: 0; background-color: white;
    border: 1px solid #ddd; border-top: none;
    border-radius: 0 0 var(--border-radius) var(--border-radius);
    z-index: 1050; max-height: 250px; overflow-y: auto;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); display: none;
}
.search-result-item {
    padding: 8px 12px; cursor: pointer; border-bottom: 1px solid #eee;
    display: flex; align-items: center; color: var(--text-color) !important; 
    font-size: calc(var(--base-font-size) * 0.9); /* Larger search result text */
}
.search-result-item:last-child { border-bottom: none; }
.search-result-item:hover { background-color: #f0f0f0; }
.search-result-item .status-dot {
    width: 10px; height: 10px; border-radius: 50%; margin-left: 8px; flex-shrink: 0;
}
.search-result-item .result-name {
    flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.search-result-item .result-name .text-muted { font-size: calc(var(--base-font-size) * 0.8); } /* Slightly larger */
.search-results .no-results { 
    padding: 10px; color: #6c757d; text-align: center; 
    font-size: calc(var(--base-font-size) * 0.9); /* Larger no results text */
}

/* Sidebar */
.sidebar {
    background-color: white;
    box-shadow: var(--shadow);
    z-index: 1000; 
    position: fixed; 
    top: var(--header-height);
    right: 0; 
    height: calc(100vh - var(--header-height) - var(--footer-height));
    width: 0; 
    transform: translateX(100%); 
    transition: transform 0.3s ease-in-out, width 0.3s ease-in-out;
    overflow-y: auto; 
}
.sidebar.active { 
    width: var(--sidebar-width-mobile); 
    transform: translateX(0); 
}
.sidebar-content { padding: 15px; }
.sidebar-header span { /* Main title in sidebar */
    font-size: calc(var(--base-font-size) * 1.15); /* Larger */
    font-weight: 700; /* Bolder */
    color: var(--primary-color);
}
.btn-close-sidebar { /* Ensure it's easily clickable */
    font-size: 1.25rem;
    padding: 0.5rem;
}

.city-search-section h3, .filter-section h3, .info-section h3 {
    font-size: calc(var(--base-font-size) * 1.05); /* Larger section titles */
    font-weight: 700; /* Bolder */
    margin-bottom: 12px; 
    color: var(--secondary-color);
}
.filter-section .form-check, .city-search-section .form-check { 
    margin-bottom: 10px; /* More spacing */
    font-size: calc(var(--base-font-size) * 0.95); /* Larger filter labels */
}
.form-check-input:checked { background-color: var(--primary-color); border-color: var(--primary-color); }
.recent-updates-list .update-item {
    padding-bottom: 12px; margin-bottom: 12px; border-bottom: 1px solid #f0f0f0;
}
.recent-updates-list .update-item:last-child { border-bottom: none; margin-bottom: 0; }
.update-name { font-weight: 500; color: var(--text-color); font-size: calc(var(--base-font-size) * 0.95); }
.update-status { font-size: calc(var(--base-font-size) * 0.9); margin: 4px 0; }
.update-status i { margin-left: 6px; }
.update-time { font-size: calc(var(--base-font-size) * 0.8); color: #6c757d; }
.update-time i { margin-left: 6px; }

/* Footer Navigation */
.footer-nav {
    height: var(--footer-height);
    flex-shrink: 0;
    background-color: var(--primary-color) !important;
    box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
    z-index: 1020;
}
.footer-nav .nav-item {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    height: 100%; color: var(--text-color-light) !important; text-decoration: none;
    font-size: calc(var(--base-font-size) * 0.8); /* Larger footer text */
    cursor: pointer; transition: background-color 0.2s ease;
    -webkit-tap-highlight-color: transparent;
}
.footer-nav .nav-item:hover, .footer-nav .nav-item.active { background-color: rgba(255, 255, 255, 0.15); }
.footer-nav .nav-item i { font-size: calc(var(--base-font-size) * 1.3); margin-bottom: 3px; color: var(--text-color-light) !important; } /* Larger footer icons */
.footer-nav .nav-item span { color: var(--text-color-light) !important; }

/* Floating Elements: Legend, FABs, Zoom */
.status-legend, .fab-location, .zoom-controls {
    position: fixed;
    z-index: 990; 
}
.fab-location, .zoom-btn {
    background-color: white; border: none; border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    display: flex; align-items: center; justify-content: center; cursor: pointer;
    transition: background-color 0.2s, transform 0.1s;
}
.fab-location:hover, .zoom-btn:hover { background-color: #f0f0f0; }
.fab-location:active, .zoom-btn:active { transform: scale(0.95); }
.fab-location i, .zoom-btn i { color: var(--primary-color); }

.status-legend {
    bottom: calc(var(--footer-height) + 15px);
    right: 15px; 
    background-color: rgba(255,255,255,0.95); padding: 12px; /* More padding */
    border-radius: var(--border-radius); box-shadow: var(--shadow);
    max-width: 150px; /* Increased max-width */
}
.status-title { font-weight: 700; margin-bottom: 10px; font-size: calc(var(--base-font-size) * 0.9); } /* Bolder and larger */
.status-item { display: flex; align-items: center; margin-bottom: 8px; font-size: calc(var(--base-font-size) * 0.85); } /* Larger */
.status-item:last-child { margin-bottom: 0; }
.status-color { width: 14px; height: 14px; border-radius: 50%; margin-left: 10px; flex-shrink: 0; } /* Larger status color dots */
.status-open { background-color: var(--success-color); }
.status-traffic { background-color: var(--warning-color); }
.status-closed { background-color: var(--danger-color); }
.status-unknown-color { background-color: var(--unknown-color); } 

.fab-location {
    bottom: calc(var(--footer-height) + 15px);
    left: 15px; 
    width: 50px; height: 50px; /* Bigger FAB */
}
.fab-location i { font-size: 1.4rem; } /* Bigger icon in FAB */

.zoom-controls {
    bottom: calc(var(--footer-height) + 15px + 50px + 15px); 
    left: 15px; 
    display: flex; flex-direction: column; gap: 10px; /* More gap */
}
.zoom-btn { width: 42px; height: 42px; } /* Bigger zoom buttons */
.zoom-btn i { font-size: 1.1rem; } /* Bigger zoom icons */

/* Leaflet Customizations */
.leaflet-div-icon-custom { 
    background: transparent !important;
    border: none !important;
    display: flex; 
    align-items: center;
    justify-content: center;
}
.user-location-pulse { 
    width: 20px; /* Matches JS icon size */
    height: 20px;
    border-radius: 50%;
    animation: pulse-animation 1.5s infinite ease-out;
    position: relative; 
}
@keyframes pulse-animation { 
    0% { box-shadow: 0 0 0 0px var(--primary-color-alpha); }
    70% { box-shadow: 0 0 0 15px rgba(156,39,176,0); } /* Wider pulse */
    100% { box-shadow: 0 0 0 0px rgba(156,39,176,0); }
}

.leaflet-popup-content-wrapper { border-radius: var(--border-radius)!important; padding:0!important; overflow:hidden; box-shadow:0 1px 3px rgba(0,0,0,.4); }
.leaflet-popup-content { margin:0!important; min-width:240px; max-width:280px!important; color:var(--text-color)!important; } /* Increased min-width */
.popup-header { padding:12px 15px; color:#fff!important; font-weight:700; font-size: calc(var(--base-font-size) * 1.05); } /* Bolder & Larger */
.popup-content-body { padding:15px; } /* More padding */
.popup-item { display:flex; align-items:center; margin-bottom:8px; font-size: calc(var(--base-font-size) * 0.95); } /* Larger */
.popup-item:last-child { margin-bottom:0; }
.popup-icon { margin-left:10px; width:20px; text-align:center; color:#555; font-size: 1.1em; } /* Bigger icon */
.prediction-separator { margin:12px 0; border:0; border-top:1px solid #eee; }
.prediction-info { color:var(--secondary-color); }
.prediction-error { color:var(--danger-color); }
.leaflet-popup-close-button { color:#fff!important; text-shadow:0 1px 2px rgba(0,0,0,.2); font-size: 1.2rem !important; padding: 5px !important;} /* Larger close button */
.leaflet-popup-close-button:hover { color:var(--text-color-light)!important; }
.checkpoint-marker-highlight { transform:scale(1.4) !important; z-index:10000!important; } /* More highlight */
.leaflet-marker-icon { visibility:visible!important; opacity:1!important; pointer-events:auto!important; }
.leaflet-control-attribution { background:rgba(255,255,255,.8)!important; font-size:calc(var(--base-font-size) * 0.7); padding:2px 4px!important; }

/* Modals */
.modal-header { border-bottom: 1px solid #dee2e6; }
.modal-title { font-weight: 700; font-size: calc(var(--base-font-size) * 1.2); } /* Bolder & Larger */
.modal-content { border-radius: 0.5rem; }
.modal-body, .modal-body p, .modal-body li { font-size: calc(var(--base-font-size) * 0.95); } /* Larger modal text */
.safari-help { background-color:#f8f9fa; padding:15px; border-radius:var(--border-radius); border-right:3px solid var(--primary-color); font-size:calc(var(--base-font-size) * 0.9); }
.safari-help h6 { color:var(--primary-color); margin-bottom:10px; font-weight:700; font-size: calc(var(--base-font-size) * 1.0); } /* Bolder */
.safari-help ol { padding-right:20px; margin-bottom:0; }
.safari-help li { margin-bottom:5px; }
#recent-destinations-container .recent-title { font-size:calc(var(--base-font-size) * 0.95); font-weight:700; color:#555; margin-bottom:10px; } /* Bolder */
#recent-destinations-list .recent-item { display:flex; align-items:center; padding:10px 12px; border-radius:var(--border-radius); cursor:pointer; margin-bottom:5px; transition:background-color .2s; text-align:right; font-size: calc(var(--base-font-size) * 0.95); } /* Larger */
#recent-destinations-list .recent-item:hover { background-color:#f0f0f0; }
#recent-destinations-list .recent-item i { margin-left:10px; color:#777; }
#recent-destinations-list .no-recent { font-size:calc(var(--base-font-size) * 0.95); }

/* Toast Container */
.toast-container {
    z-index: 1100 !important; 
    bottom: calc(var(--footer-height) + 10px) !important; 
}
.toast { box-shadow:0 .25rem .75rem rgba(0,0,0,.1); opacity:.95; }
.toast-body { font-size: calc(var(--base-font-size) * 0.95); } /* Larger toast text */

/* --- RESPONSIVE --- */
/* Desktop: Sidebar is part of the flow */
@media (min-width: 992px) {
    .app-header .search-container { margin-right: 15px; margin-left: auto; max-width: 400px; } /* Wider search */
    .content-wrapper { /* flex-direction: row-reverse; already set for RTL globally */ }
    .sidebar {
        position: relative; 
        transform: translateX(0); 
        width: var(--sidebar-width-desktop) !important; 
        height: 100%; 
        flex-shrink: 0; 
        box-shadow: -2px 0 5px rgba(0,0,0,0.05); 
        bottom: auto; top: auto;
        transition: none; 
    }
    .status-legend { right: calc(var(--sidebar-width-desktop) + 20px); left: auto; bottom: 20px; }
    .fab-location { left: auto; right: calc(var(--sidebar-width-desktop) + 20px); }
    .zoom-controls { left: auto; right: calc(var(--sidebar-width-desktop) + 20px); }
    .btn-close-sidebar { display: none; } 
    .footer-nav .nav-item span { font-size: calc(var(--base-font-size) * 0.85); } /* Slightly larger footer text */
    .footer-nav .nav-item i { font-size: calc(var(--base-font-size) * 1.4); } /* Slightly larger footer icons */
}


/* Tablet and Mobile: Sidebar is an overlay */
@media (max-width: 991.98px) {
    .status-legend { right: 15px; left: auto; } 
    .fab-location { left: 15px; right: auto; }
    .zoom-controls { left: 15px; right: auto; }
    .btn-close-sidebar { display: block; } 
}

/* Small Mobile refinements */
@media (max-width: 575.98px) {
    :root { --base-font-size: 15px; } /* Slightly smaller base for very small screens */
    .app-header .navbar-brand { font-size: calc(var(--base-font-size) * 1.1); }
    .app-header .navbar-brand img { width: 22px; height: 22px; margin-left: 5px; }
    #search-input { font-size: calc(var(--base-font-size) * 0.9); height: calc(var(--header-height) - 22px); }
    
    .footer-nav .nav-item span { font-size: calc(var(--base-font-size) * 0.75); }
    .footer-nav .nav-item i { font-size: calc(var(--base-font-size) * 1.1); margin-bottom: 2px;}

    .fab-location { width: 40px; height: 40px; left: 10px; bottom: calc(var(--footer-height) + 10px); }
    .fab-location i { font-size: 1rem; }
    .zoom-controls { left: 10px; bottom: calc(var(--footer-height) + 10px + 40px + 10px); gap: 5px;}
    .zoom-btn { width: 34px; height: 34px; }
    .status-legend { padding: 8px; right: 10px; bottom: calc(var(--footer-height) + 10px); min-width: 110px;}
    .status-legend .status-title { font-size: calc(var(--base-font-size) * 0.8); margin-bottom: 5px;}
    .status-legend .status-item { font-size: calc(var(--base-font-size) * 0.75); margin-bottom: 4px;}
    .status-legend .status-color { width: 10px; height: 10px; margin-left: 5px;}
    .modal-dialog { margin: 0.5rem; }
    .popup-header { font-size: calc(var(--base-font-size) * 0.95); }
    .popup-content-body, .popup-item { font-size: calc(var(--base-font-size) * 0.85); }
}

/* iOS Safari height fix */
@supports (-webkit-touch-callout: none) {
    html, body, .app-container {
        min-height: -webkit-fill-available;
    }
}
